!function(){"use strict";function e(e){e.debug("Footer loaded")}e.$inject=["$log"],angular.module("common.footer",[]).controller("FooterCtrl",e)}(),function(){"use strict";function e(e){e.debug("Header loaded")}e.$inject=["$log"],angular.module("common.header",[]).controller("HeaderCtrl",e)}(),function(){"use strict";function e(e,n,o,t){function a(){t.current.name?(o.currentContent={"root.business-service":"root.business","root.business-employee":"root.business","root.employee":"root.business","root.msglist":"root.business","root.business-sms":"root.business","root.business-sms-module":"root.business","root.employee-service":"root.business","root.business-create":"root.business","root.role-authorization":"root.role","root.role-user":"root.role","root.channel-user":"root.channel-info"}[t.current.name],o.currentContent||(o.currentContent=t.current.name)):o.currentContent=n.menuList[0].content}e.debug("menu loaded"),n.menuList=[{attr:"fa-gears",content:"root.business",name:"企业管理"},{attr:"fa-bar-chart-o",content:"root.common-service",name:"服务管理"},{attr:"fa-th-list",content:"root.channel-info",name:"渠道管理"},{attr:"fa-picture-o",content:"root.showcase-info",name:"橱窗信息"},{attr:"fa-tasks",content:"root.statistic",name:"数据统计"},{attr:"fa-file",content:"root.data-manager",name:"数据管理",open:!1,submenu:[{content:"root.employee-info",name:"员工信息"},{content:"root.policy-info",name:"保单信息"}]},{attr:"fa-users",content:"root.role-manager",name:"角色管理",open:!1,submenu:[{content:"root.role-module",name:"管理模块"},{content:"root.role",name:"用户和权限管理"}]},{attr:"fa-tags",content:"root.logger",name:"日志管理"}],a(),n.chooseMenu=function(e){e.submenu?e.open=!e.open:(t.go(e.content),o.currentContent=e.content)},n.setLi=function(e){if(e.submenu){if(1==e.open)return"open";if(0==e.open){for(var n=0;n<e.submenu.length;n++)if(e.submenu[n].content==o.currentContent)return"active";return""}}else if(o.currentContent==e.content)return"active"}}e.$inject=["$log","$scope","$rootScope","$state"],angular.module("common.menu",[]).controller("MenuCtrl",e)}(),function(){"use strict";function e(e){e.state("root.app-manager",{url:"/app-manager",views:{"@":{templateUrl:"templates/app-manager/app-manager.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("app-manager",[]).config(e).controller("appManager",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(n,o){n&&(n.size>=2097152?(document.getElementById(o).value="",t.showToast("error","允许上传的图片的最大为2M，请重新选择"),t.$apply()):(e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else{var o=n.target.result,t=new Image;t.src=o,t.onload=function(){t.width,t.height;e.pictureShow=o,e.aboutUs.orgPicture=n.target.result,e.$apply()}}},e.reader.readAsDataURL(n)))}e.showDetail=!1,e.tfsUrl=o.getTfsUrl(),e.init=function(){o.run("aboutusQuery",null,function(n){e.appInfoList=n.rows},function(e){})},e.paramInitial=function(){e.aboutUs={id:null,title:null,versionNo:null,versionCode:null,orgPicture:null,picture:null,url:null,forceUpdate:null,updateDate:null,size:null,platform:null,changeLog:null,description:null,enable:null}},e.init(),e.showDetailTab=function(n){n?e.showDetailId=n:e.showDetailId=null},e.createAPPInfoFlag="",e.openModal=function(n){if(e.paramInitial(),e.pictureShow="",t.modalStus(!0),n){if(e.createAPPInfoFlag="modify",e.aboutUs.id=n.id,e.aboutUs.title=n.title,e.aboutUs.versionNo=n.versionNo,e.aboutUs.versionCode=n.versionCode,e.aboutUs.picture=n.picture,e.aboutUs.url=n.url,e.aboutUs.forceUpdate=n.forceUpdate,e.aboutUs.size=n.size,e.aboutUs.platform=n.platform,e.aboutUs.description=n.description,e.aboutUs.enable=n.enable,e.aboutUs.updateDate=n.updateDate,e.aboutUs.changeLog=n.changeLog,e.aboutUs.picture){var a=o.getTfsUrl();e.pictureShow=a+e.aboutUs.picture}}else e.createAPPInfoFlag="create",e.aboutUs.enable=!1,e.aboutUs.forceUpdate=!0,e.aboutUs.platform="IOS"},e.closeModal=function(){e.createAPPInfoFlag="",t.modalStus(!1)},e.chooseImg=function(){var e=event.target.files[0],n=event.target.id;a(e,n)},e.chooseDayOpen=function(n){e.startStatus.opened=!0},e.startStatus={opened:!1},e.saveCreateEmployee=function(){console.log(e.aboutUs),"create"==e.createAPPInfoFlag?o.run("aboutusCreate",e.aboutUs,function(n){e.createAPPInfoFlag="",e.init()},function(e){}):o.run("aboutusUpdate",e.aboutUs,function(n){e.createAPPInfoFlag="",e.init()},function(e){})}}])}(),function(){"use strict";function e(e){e.state("root.business-create",{url:"/business-create",views:{"@":{templateUrl:"templates/business-create/business-create.tpl.html",controller:"createBusiness"}}})}e.$inject=["$stateProvider"],angular.module("business-create",[]).config(e).controller("createBusiness",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(n,o){n&&(n.size>1048576?(document.getElementById(o).value="",e.createBusiness[o]=null,e.imgShow="",t.showToast("error","允许上传的图片最大为1M，请重新选择！"),t.$apply()):(e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else if("show"==o)e.imgShow=n.target.result,e.$apply();else{var a=new Image;a.src=n.target.result,a.onload=function(){var s=a.width,i=a.height,l=e.checkImg(o,s,i);1==l?(e.createBusiness[o]=n.target.result,e.$apply()):(document.getElementById(o).value="",e.createBusiness[o]=null,e.imgShow="",t.showToast("error",l),t.$apply())}}},e.reader.readAsDataURL(n)))}e.createSts="businessCreate",e.createBusiness={name:null,type:1,orgLogo:null,orgStartLogo:null,outUserId:null,needVerify:!0,verifyType:1,enable:!1,startDate:null,endDate:null,verifyAll:!1,verifyTypes:null},e.verifyTypes={workNo:"",idNo:"",insNo:""},e.firstCreateCrowd=!0,e.imgShow="",e.saveBusiness=function(){var n=[];for(var t in e.verifyTypes)""!=e.verifyTypes[t]&&n.push(e.verifyTypes[t]);e.createBusiness.verifyTypes=n.join(),console.log(e.createBusiness),o.run("businessCreate",e.createBusiness,function(n){e.imgShow="",e.createSts="crowdCreate",o.setBusinessId(n.model.id)},function(e){})},e.saveCrowd=function(){var n=o.getInitialParam("businessEmployeeCreate");n.name=e.employeeCreateName,o.run("businessEmployeeCreate",null,function(n){e.employeeCreateName=null,e.firstCreateCrowd=!1},function(e){})},e.createCrowdComplete=function(){n.go("root.business")},e.chooseImg=function(){var n=event.target.files[0],o=event.target.id;e.imgShow="";var s=n.name,i=s.lastIndexOf(".")>-1&&s.substring(s.lastIndexOf(".")+1)||"";return"png"!=i?(t.showToast("error","请选择正确格式的图片，当前仅支持png格式！"),t.$apply(),void(event.target.value="")):void a(n,o)},e.show=function(e){var n=document.getElementById(e).files[0];a(n,"show")},e.checkImg=function(e,n,o){var a=!0;return"orgLogo"==e||"orgStartLogo"==e&&(a=!(n>t.constant.orgStartLogo.width||o>t.constant.orgStartLogo.height)||"长不能超过"+t.constant.orgStartLogo.width+"px, 高不能超过"+t.constant.orgStartLogo.height+"px"),a},e.disabledEndDay=function(n,o){e.createBusiness.startDate},e.disabledStartDay=function(n,o){e.createBusiness.endDate},e.startStatusOpen=function(n){e.startStatus.opened=!0},e.endStatusOpen=function(n){e.endStatus.opened=!0},e.startStatus={opened:!1},e.endStatus={opened:!1}}])}(),function(){"use strict";function e(e){e.state("root.business",{url:"/business",views:{"@":{templateUrl:"templates/business/business.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("business",[]).config(e).controller("business",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(){e.paramInitial(),e.loadData()}function s(n,o){n&&(n.size>1048576?(document.getElementById(o).value="",t.showToast("error","允许上传的图片的最大为1M，请重新选择"),t.$apply()):(e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else{var a=n.target.result,s=new Image;s.src=a,s.onload=function(){var i=s.width,l=s.height,r=e.checkImg(o,i,l);1==r.flag?(e[o+"Show"]=a,e.businessEdit[o]=n.target.result,e.$apply()):(t.showToast("error",r.msg),t.$apply()),document.getElementById(o).value=""}}},e.reader.readAsDataURL(n)))}e.orderBy=null,e.sortString=null,e.modalShow=!1,e.paramInitial=function(){e.businessParam={pageIndex:1,pageCount:20,keywords:null,sort:null,orderBy:null}},e.createBusiness=function(){n.go("root.business-create")},e.loadData=function(){o.run("businessQueryAll",e.businessParam,function(n){e.businessList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},a(),e.pageChanged=function(){e.businessParam.pageIndex=e.pageInfo.pageIndex,e.loadData()},e.search=function(){e.businessParam.keywords=e.keywords,e.businessParam.pageIndex=1,e.loadData()},e.clean=function(){e.keywords=null,e.sortString=null,e.orderBy=null,e.paramInitial(),e.loadData()},e.closeModal=function(){e.modalShow=!1,t.modalStus(!1)},e.businessModify=function(n){var a=o.getInitialParam("businessQuery");a.id=n,o.run("businessQuery",null,function(n){e.businessEdit=n.model,e.businessEdit.orgLogo=null,e.businessEdit.orgSlogan=null,e.businessEdit.orgStartLogo=null;var a=o.getTfsUrl();e.orgLogoShow="",e.orgStartLogoShow="",e.businessEdit.logo&&(e.orgLogoShow=a+e.businessEdit.logo),e.businessEdit.startLogo&&(e.orgStartLogoShow=a+e.businessEdit.startLogo),e.verifyTypes={workNo:"",idNo:"",insNo:""};for(var s=(e.businessEdit.verifyTypes||"").split(","),i=0;i<s.length;i++)"1"==s[i]&&(e.verifyTypes.workNo="1"),"2"==s[i]&&(e.verifyTypes.idNo="2"),"3"==s[i]&&(e.verifyTypes.insNo="3");t.modalStus(!0),e.modalShow=!0,e.opration="edit"},function(e){})},e.businessQuery=function(n){e.logoShow="",e.startLogoShow="";var a=o.getTfsUrl();e.businessShow={};var s=o.getInitialParam("businessQuery");s.id=n,o.run("businessQuery",null,function(n){e.businessShow=n.model,e.businessShow.logo&&(e.logoShow=a+e.businessShow.logo),e.businessShow.startLogo&&(e.startLogoShow=a+e.businessShow.startLogo),e.opration="show",t.modalStus(!0),e.modalShow=!0},function(e){})},e.saveBusinessEdit=function(){var n=[];for(var t in e.verifyTypes)""!=e.verifyTypes[t]&&n.push(e.verifyTypes[t]);e.businessEdit.verifyTypes=n.join(),o.run("businessUpdate",e.businessEdit,function(n){e.businessEdit=null,e.loadData(),e.closeModal()},function(e){})},e.rmStartLogo=function(){e.businessEdit.orgStartLogo=null,e.businessEdit.startLogo&&o.run("deleteStartLogo",{businessId:e.businessEdit.id},function(n){e.businessEdit.startLogo="",t.showToast("success","删除成功"),e.orgStartLogoShow=""},function(e){})},e.sortByString=function(n){e.orderBy=null;var o=event.target.getAttribute("class");e.sortString=event.target.getAttribute("aria-label"),console.log(o,e.sortString),"sorting"==o||"sorting_asc"==o?e.orderBy="DESC":e.orderBy="ASC",e.businessParam.orderBy=e.sortString,e.businessParam.sort=e.orderBy,e.businessParam.pageIndex=1,e.loadData()},e.setLocalStorage=function(e){o.setBusinessId(e)},e.setBusinessInfo=function(e){o.setBusinessInfo(e)},e.startStatusOpen=function(n){e.startStatus.opened=!0},e.endStatusOpen=function(n){e.endStatus.opened=!0},e.startStatus={opened:!1},e.endStatus={opened:!1},e.chooseImg=function(){var e=event.target.files[0],n=event.target.id,o=e.name,a=o.lastIndexOf(".")>-1&&o.substring(o.lastIndexOf(".")+1)||"";return"png"!=a?(t.showToast("error","请选择正确格式的图片，当前仅支持png格式！"),t.$apply(),void(event.target.value="")):void s(e,n)},e.checkImg=function(e,n,o){var a={flag:!1,msg:""};return"orgLogo"==e?a.flag=!0:"orgSlogan"==e?n>t.constant.orgSlogan.width||o>t.constant.orgSlogan.height?a.msg="长不能超过"+t.constant.orgSlogan.width+"px, 高不能超过"+t.constant.orgSlogan.height+"px":a.flag=!0:"orgStartLogo"==e&&(n>t.constant.orgStartLogo.width||o>t.constant.orgStartLogo.height?a.msg="长不能超过"+t.constant.orgStartLogo.width+"px, 高不能超过"+t.constant.orgStartLogo.height+"px":a.flag=!0),a}}])}(),function(){"use strict";function e(e){e.state("root.business-employee",{url:"/business-employee",views:{"@":{templateUrl:"templates/business-employee/business-employee.tpl.html",controller:"createBusinessmployee"}}})}e.$inject=["$stateProvider"],angular.module("business-employee",[]).config(e).controller("createBusinessmployee",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(){o.run("businessEmployeeQuery",null,function(n){e.employeeList=n.model},function(e){})}e.createEmployee=!1,e.addEmployeeName=null,e.addNotice=null,a(),e.openModal=function(n,o,a){e.createEmployee=!0,t.modalStus(!0),n?(e.employeeId=n,e.addEmployeeName=o,e.addNotice=a):e.employeeId=null},e.closeModal=function(){e.createEmployee=!1,e.addEmployeeName=null,e.addNotice=null,t.modalStus(!1)},e.saveCreateEmployee=function(){var n="";e.employeeId?(n=o.getInitialParam("businessEmployeeUpdate"),n.name=e.addEmployeeName,n.notice=e.addNotice,n.id=e.employeeId,o.run("businessEmployeeUpdate",null,function(n){e.addEmployeeName=null,e.addNotice=null,e.createEmployee=!1,t.modalStus(!1),a()},function(e){})):(n=o.getInitialParam("businessEmployeeCreate"),n.name=e.addEmployeeName,n.notice=e.addNotice,o.run("businessEmployeeCreate",null,function(n){e.addEmployeeName=null,e.addNotice=null,e.createEmployee=!1,t.modalStus(!1),a()},function(e){}))},e.setLocalStorage=function(e){o.setEmployeeId(e)}}])}(),function(){"use strict";function e(e){e.state("root.msglist",{url:"/msglist/:bussinessId",views:{"@":{templateUrl:"templates/business-msg/list.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("msglist",["underscore"]).config(e).controller("msglist",["$scope","$state","DataService","$rootScope","_",function(e,n,o,t,a){function s(){e.createStartTime&&(e.NewsAction.createStartTime=date2string(e.createStartTime)),e.createEndTime&&(e.NewsAction.createEndTime=date2string(e.createEndTime)),o.run("newsQueryAll",e.NewsAction,function(n){e.NewsList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount),o.run("businessEmployeeQuery",{businessId:e.bussinessId},function(n){e.employeeType=n.model})},function(e){})}e.bussinessId=n.params.bussinessId,e.paramInitial=function(){e.NewsAction={pageIndex:1,pageCount:20,createStartTime:null,createEndTime:null,orderBy:"id",sort:"desc",businessId:e.bussinessId}},e.operationTypeList=[{value:1,text:"普通消息"}],e.pageChanged=function(){e.NewsAction.pageIndex=e.pageInfo.pageIndex,s()},e.init=function(){e.paramInitial(),e.createStartTime=null,e.createEndTime=null,s()},e.showModal=!1,e.collapseId=null,e.init(),e.search=function(){s()},e.sortByString=function(){e.orderBy=null;var n=event.target.getAttribute("class");e.sortString=event.target.getAttribute("aria-label"),"sorting"==n||n.indexOf("sorting_asc")>-1?e.orderBy="DESC":e.orderBy="ASC",e.NewsAction.orderBy=e.sortString,e.NewsAction.sort=e.orderBy,e.NewsAction.pageIndex=1,s()},e.openModal=function(n,o){var s;o&&(s=JSON.parse(JSON.stringify(o))),e.opration=n,t.modalStus(!0),s?(s.employeeTypeNewsList||(s.employeeTypeNewsList=[]),a.each(s.employeeTypeNewsList,function(e){e.businessEmployeeType&&(e.name=e.businessEmployeeType.name),e.selected=!0}),a.each(e.employeeType,function(e){var n=a.find(s.employeeTypeNewsList,function(n){return n.employeeTypeId==e.id});n?angular.extend(n,e):s.employeeTypeNewsList.push(e)}),s.employeeTypeNewsList=a.sortBy(s.employeeTypeNewsList,function(e){return e.id}),e.newsItem=s):e.newsItem={title:null,businessId:e.bussinessId,type:1,content:null,enable:!0,employeeTypeNewsList:e.employeeType,startDate:null,endDate:null},e.modalShow="show"},e.chooseStartDate=function(n){e.startDateStatus.opened=!0},e.startDateStatus={opened:!1},e.chooseEndDate=function(n){e.endDateStatus.opened=!0},e.endDateStatus={opened:!1},e.saveNews=function(){var n=a.filter(e.newsItem.employeeTypeNewsList,function(e){return 1==e.selected});return 0==n.length?void alert("请选择推送人群"):(e.newsItem.employeeTypeNewsList=n,a.each(e.newsItem.employeeTypeNewsList,function(e){e.employeeTypeId=e.id}),void("create"==e.opration?o.run("newsCreate",e.newsItem,function(n){e.NewsAction.pageIndex=1,s(),e.closeModal()},function(e){}):"edit"==e.opration&&o.run("newsUpdate",e.newsItem,function(n){s(),e.closeModal()},function(e){})))},e.closeModal=function(){e.modalShow=null,e.opration=null,e.serviceIconShow="",e.commonServiceEdit={},e.commonServiceShow={},t.modalStus(!1)},e.showDetail=function(n){var a=o.getInitialParam("newsQuery");a.id=n.id,o.run("newsQuery",null,function(n){e.detailList=n.model,e.showModal=!0,t.modalStus(!0)},function(e){})},e.hideModal=function(){e.showModal=!1,e.comment=null,e.detailList=null,e.contentList=null,t.modalStus(!1)},e.showDetailContent=function(n){var t=o.getInitialParam("newsQuery");t.NewsId=n,o.run("newsQuery",null,function(n){e.contentList=n.model},function(e){});var a=event.target.getAttribute("data-action");"expand"==a?(e.collapseId=n,e.detailContentId=n):(e.collapseId=null,e.detailContentId=null)},e.startDayOpen=function(n){e.startDay.opened=!0},e.startDay={opened:!1},e.endDayOpen=function(n){e.endDay.opened=!0},e.endDay={opened:!1}}])}(),function(){"use strict";function e(e){e.state("root.business-service",{url:"/business-service",views:{"@":{templateUrl:"templates/business-service/business-service.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("business-service",[]).config(e).controller("businessService",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.loadCommonService=function(){o.run("serviceQueryAll",null,function(n){e.serviceList=n.rows,e.loadBusinessService()},function(e){})},e.loadCommonService(),e.loadBusinessService=function(){o.run("businessServiceQuery",null,function(n){e.businessServicePool=n.model;var o,t;for(o=0;o<e.businessServicePool.length;o++)for(t=0;t<e.serviceList.length;t++)if(e.businessServicePool[o].serviceId==e.serviceList[t].id){e.businessServicePool[o].name=e.serviceList[t].name;break}for(e.serviceAvailableList=[],o=0;o<e.serviceList.length;o++)e.serviceAvailableList.push({id:e.serviceList[o].id,name:e.serviceList[o].name,enable:e.serviceList[o].enable});for(o=0;o<e.businessServicePool.length;o++)for(t=0;t<e.serviceAvailableList.length;t++)e.businessServicePool[o].serviceId==e.serviceAvailableList[t].id&&e.serviceAvailableList.splice(t,1);for(var o=0;o<e.serviceAvailableList.length;o++)0==e.serviceAvailableList[o].enable&&(e.serviceAvailableList[o].name=e.serviceAvailableList[o].name+"（该服务未启用）")},function(e){})},e.openModal=function(n,o){e.opration=n,"show"==n?(e.businessServiceShow=o,e.modalShow="show",t.modalStus(!0)):o?(e.businessServiceName=o.name,e.businessServiceEdit={id:o.id,serviceId:o.serviceId,url:o.url,enable:o.enable},e.modalShow="show",t.modalStus(!0)):0==e.serviceAvailableList.length?t.showToast("error","当前服务库中已经没有可创建的企业服务，请先在服务管理中创建服务后再创建企业服务。"):(e.businessServiceEdit={serviceId:e.serviceAvailableList[0].id,url:null,enable:!0},e.modalShow="show",t.modalStus(!0))},e.saveServiceEdit=function(){"create"==e.opration?(e.businessServiceEdit.businessId=o.getInitialParam("businessServiceCreate").businessId,o.run("businessServiceCreate",e.businessServiceEdit,function(n){e.loadBusinessService(),e.closeModal()},function(e){})):"edit"==e.opration&&(e.businessServiceEdit.businessId=o.getInitialParam("businessServiceUpdate").businessId,o.run("businessServiceUpdate",e.businessServiceEdit,function(n){e.loadBusinessService(),e.closeModal()},function(e){}))},e.closeModal=function(){e.modalShow=null,e.opration=null,e.businessServiceeEdit={},e.businessServiceShow={},t.modalStus(!1)}}])}(),function(){"use strict";function e(e){e.state("root.business-sms",{url:"/business-sms/:businessId",views:{"@":{templateUrl:"templates/business-sms/business-sms.tpl.html"}}}).state("root.business-sms-module",{url:"/business-sms-module/:businessId",views:{"@":{templateUrl:"templates/business-sms/business-sms-module.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("business-sms",[]).config(e).controller("smsManager",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.businessId=n.params.businessId,e.titleInfo={title:"企业管理",href:"#/business",subtitle:"短信发送管理"},e.businessInfo=o.getBusinessInfo(),e.initParam=function(){e.smsSearchInfo={businessId:e.businessId,pageIndex:1,pageCount:20,employeeTypeId:null,name:null,mobile:null,tplKey:null,isSent:null,cardNo:null}},e.getEmployeeName=function(n){if(e.employeeList)for(var o=0;o<e.employeeList.length;o++)if(n==e.employeeList[o].id)return e.employeeList[o].name},e.loadSMSInfo=function(){""==e.smsSearchInfo.name?e.smsSearchInfo.name=null:"",""==e.smsSearchInfo.mobile?e.smsSearchInfo.mobile=null:"",""==e.smsSearchInfo.cardNo?e.smsSearchInfo.cardNo=null:"",o.run("sendMessageQueryAll",e.smsSearchInfo,function(n){e.smsManagerList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.loadEmployee=function(){var n={businessId:e.businessId};o.run("businessEmployeeQuery",n,function(n){e.employeeList=n.model||[],e.employeeList.unshift({id:null,name:"请选择"})},function(e){})},e.loadMsgTpl=function(){var n=angular.copy(o.getInitialParam("msgTplQueryAll"));n.pageCount=100,o.run("msgTplQueryAll",n,function(n){e.smsModuleList=n.rows||[],e.smsModuleList.unshift({tplKey:null,name:"请选择"})},function(e){})},e.initParam(),e.loadEmployee(),e.loadMsgTpl(),e.loadSMSInfo(),e.pageChanged=function(){e.smsSearchInfo.pageIndex=e.pageInfo.pageIndex,e.loadSMSInfo()},e.openModal=function(n,o){e.operation=n,t.modalStus(!0),"importInfo"==e.operation||"importPsd"==e.operation||("SMS"==e.operation?e.sms={employeeTypeId:null,tplKey:null}:"show"==e.operation&&(e.smsManagerInfo=angular.copy(o))),e.modalShow="show"},e.closeModal=function(){e.modalShow=null,e.operation=null,t.modalStus(!1),e.smsManagerInfo?e.smsManagerInfo={}:""},e.dataServiceRun=function(n,t,a){o.run(n,t,function(n){e.closeModal(),setTimeout(e.loadSMSInfo(),500),a&&a()},function(e){})},e.saveSMSManagerInfo=function(n,o){var a="",s=e.operation,i=!1,l=null;n&&(s=n);var r={};"SMS"==s?(a="sendMessageBatchSend",r=angular.copy(e.sms),r.businessId=e.businessId,l=function(){t.showToast("success","短信已发送！温馨提示：由于发送短信为异步操作，短信发送成功可能会稍有延迟，请稍后手动刷新页面查看短信发送状态，谢谢~")}):"importCard"==s?(i=!0,t.showToast("confirm","请确认导入的卡密是否与导入的员工数量相匹配，如果卡密数量多于员工数量，会造成多于卡密的浪费，确定现在导入卡密吗？",function(){a="sendMessageImportCard",r.file=e.fileBase64,e.dataServiceRun(a,r)})):"importUser"==s?(a="sendMessageImportUser",r.file=e.fileBase64):"clearCardSecret"==s?(i=!0,t.showToast("confirm","确认清空未发送的卡密信息吗？",function(){a="sendMessageClearCardSecret",r.businessId=e.businessId,e.dataServiceRun(a,r)})):"clearUnbindCard"==s?(i=!0,t.showToast("confirm","确认清除未绑卡的数据吗？",function(){a="sendMessageClearUnbindCard",r.businessId=e.businessId,e.dataServiceRun(a,r)})):"reSend"==s&&(a="sendMessageResend",r.id=o.id),i||e.dataServiceRun(a,r,l)},e.chooseFile=function(){var n=event.target.files[0];if(n){var o=n.name,a=o.lastIndexOf(".")>-1&&o.substring(o.lastIndexOf(".")+1)||"";if("xls"!=a&&"xlsx"!=a&&"xlt"!=a&&"xlsm"!=a)return t.showToast("error","导入文件格式不对，请选择正确格式的文件"),t.$apply(),void(event.target.value="");e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else{var o=n.target.result;e.fileBase64=o}},e.reader.readAsDataURL(n)}}}]).controller("smsModule",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.businessId=n.params.businessId,e.titleInfo={title:"短信发送管理",href:"#/business-sms/"+e.businessId,subtitle:"短信模板管理"},e.title="Lorem Ipsum",e.link="https://google.com",e.text="Neque porro quisquam est qui dolorem ipsum quia dolor...",e.smsParam={pageIndex:1,pageCount:20,businessId:e.businessId},e.loadSMSModuleInfo=function(){o.run("msgTplQueryAll",e.smsParam,function(n){e.smsManagerList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.loadSMSModuleInfo(),e.openModal=function(n,o){e.operation=n,t.modalStus(!0),o?e.smsManagerInfo=angular.copy(o):e.smsManagerInfo={name:null,content:null},e.modalShow="show"},e.closeModal=function(){e.modalShow=null,e.operation=null,e.smsManagerInfo={},t.modalStus(!1)},e.pageChanged=function(){e.smsParam.pageIndex=e.pageInfo.pageIndex,e.loadSMSModuleInfo()},e.saveSMSManagerInfo=function(n){n&&(e.operation="del");var a="",s=1,i=(e.operation,"");"del"==e.operation?(a="smsModuleDelete",i={id:n},t.showToast("confirm","确认删除模板吗？",function(){o.run(a,i,function(n){e.smsParam.pageIndex=s,e.loadSMSModuleInfo(),e.closeModal()},function(e){})})):(e.smsManagerInfo.businessId=e.businessId,i=e.smsManagerInfo,"create"==e.operation?a="msgTplCreate":"edit"==e.operation&&(a="msgTplUpdate",s=e.smsParam.pageIndex),o.run(a,i,function(n){e.smsParam.pageIndex=s,e.loadSMSModuleInfo(),e.closeModal()},function(e){}))}}])}(),function(){"use strict";function e(e){e.state("root.common-service",{url:"/common-service",views:{"@":{templateUrl:"templates/common-service/common-service.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("common-service",[]).config(e).controller("commonService",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(n){n&&(n.size>=2097152?alert("允许上传的图片的最大为2M，请重新选择"):(e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else{var o=n.target.result,t=new Image;t.src=o,t.onload=function(){e.serviceIconShow=o,e.commonServiceEdit.orgIcon=n.target.result,e.$apply()}}},e.reader.readAsDataURL(n)))}e.tfsUrl=o.getTfsUrl(),e.serviceIconShow="",e.commonServiceTypeList=[{type:1,name:"名医预约"},{type:2,name:"家庭医生"},{type:3,name:"体检服务"},{type:4,name:"基因检测"},{type:5,name:"慢病管理"},{type:6,name:"血压管理"},{type:8,name:"名医问诊"},{type:14,name:"挂号"},{type:15,name:"上门检测"},{type:17,name:"保险服务"},{type:18,name:"心理咨询"}],e.getName=function(n){for(var o="",t=0;t<e.commonServiceTypeList.length;t++)if(e.commonServiceTypeList[t].type==n){o=e.commonServiceTypeList[t].name;break}return o},e.serviceQueryParam={pageIndex:1,pageCount:20},e.loadService=function(){o.run("serviceQueryAll",e.serviceQueryParam,function(n){e.commonServicePool=n.rows;for(var o=0;o<e.commonServicePool.length;o++)e.commonServicePool[o].serviceName=e.getName(e.commonServicePool[o].type);e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.pageChanged=function(){e.serviceQueryParam.pageIndex=e.pageInfo.pageIndex,e.loadService()},e.loadService(),e.openModal=function(n,o){e.opration=n,t.modalStus(!0),"show"==n?(e.commonServiceShow=o,null!=e.commonServiceShow.icon&&(e.serviceIconShow=e.tfsUrl+e.commonServiceShow.icon)):o?(e.commonServiceEdit={id:o.id,name:o.name,orgIcon:null,weight:o.weight,enable:o.enable,mustHave:o.mustHave,type:o.type,icon:o.icon,url:o.url,personal:o.personal},null!=e.commonServiceEdit.icon&&(e.serviceIconShow=e.tfsUrl+e.commonServiceEdit.icon)):e.commonServiceEdit={name:null,orgIcon:null,weight:null,enable:!0,mustHave:!1,type:1,icon:null,url:null,personal:!1},e.modalShow="show"},e.forceDisabledHandler=function(n){var t=o.getInitialParam("forceDisableService");t.id=n,o.run("forceDisableService",null,function(n){e.loadService()},function(e){})},e.forceDisabled=function(n){t.showToast("confirm","是否强制禁用，该操作会影响所有添加该服务的企业？",e.forceDisabledHandler,n)},e.saveServiceEdit=function(){"create"==e.opration?o.run("commonServiceCreate",e.commonServiceEdit,function(n){e.serviceQueryParam.pageIndex=1,e.loadService(),e.closeModal()},function(e){}):"edit"==e.opration&&o.run("commonServiceUpdate",e.commonServiceEdit,function(n){e.loadService(),e.closeModal()},function(e){})},e.closeModal=function(){e.modalShow=null,e.opration=null,e.serviceIconShow="",e.commonServiceEdit={},e.commonServiceShow={},t.modalStus(!1)},e.chooseImg=function(){var e=event.target.files[0];a(e)}}])}(),function(){"use strict";function e(e){e.state("root.channel-info",{url:"/channel-info",views:{"@":{templateUrl:"templates/channel-info/channel-info.tpl.html"}}}).state("root.channel-user",{url:"/channel-user",views:{"@":{templateUrl:"templates/channel-info/channel-user.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("channel-info",[]).config(e).controller("channelInfo",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.channel={pageIndex:1,pageCount:20},e.transBool=function(e,n){return n?"0"!=e:1==e?"1":"0"},e.loadChannelInfo=function(){o.run("channelQueryAll",e.channel,function(n){e.channelInfoList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.loadBusiness=function(){var n={pageIndex:1,pageCount:1e3,keywords:null,sort:null,orderBy:null};o.run("businessQueryAll",n,function(n){e.businessList=n.rows,e.businessList.unshift({id:null,name:"请选择企业"})},function(e){})},e.pageChanged=function(){e.channel.pageIndex=e.pageInfo.pageIndex,e.loadChannelInfo()},e.loadBusiness(),e.loadChannelInfo(),e.openModal=function(n,o){e.opration=n,t.modalStus(!0),"show"==n?e.channelInfoShow=o:o?(e.channelInfoEdit=angular.copy(o),e.channelInfoEdit.enable=e.transBool(e.channelInfoEdit.enable)):e.channelInfoEdit={name:null,channelNumber:null,businessId:null,limitType:0,maxCountOfChannel:null,summaryCount:null,maxAskCountOfPerUser:null,type:0,enable:"0",productIds:null},e.modalShow="show"},e.transId=function(n){for(var o=1;o<e.businessList.length;o++)if(e.businessList[o].id==n)return e.businessList[o].name},e.saveChannelInfoEdit=function(){var n="",t=1;"create"==e.opration?n="channelCreate":"edit"==e.opration&&(n="channelUpdate",t=e.channel.pageIndex),e.channelInfoEdit.enable=e.transBool(e.channelInfoEdit.enable,"convert"),o.run(n,e.channelInfoEdit,function(n){e.channel.pageIndex=t,e.loadChannelInfo(),e.closeModal()},function(e){})},e.closeModal=function(){e.modalShow=null,e.opration=null,e.channelInfoEdit={},e.channelInfoShow={},t.modalStus(!1)},e.setLocalStorage=function(e){o.setChannelId(e)}}]).controller("channelUser",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.channel={channelId:o.getInitialParam("channelQueryAllUser").channelId,pageIndex:1,pageCount:20},e.loadChannelUserInfo=function(){o.run("channelQueryAllUser",e.channel,function(n){e.channelUserInfoList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.pageChanged=function(){e.channel.pageIndex=e.pageInfo.pageIndex,e.loadChannelUserInfo()},e.loadChannelUserInfo(),e.openModal=function(n){e.opration="show",t.modalStus(!0),e.channelUserInfo=n,e.modalShow="show"},e.closeModal=function(){e.modalShow=null,e.channelUserInfo={},t.modalStus(!1)}}])}(),function(){"use strict";function e(e){e.state("root.employee-info",{url:"/employee-info",views:{"@":{templateUrl:"templates/data-manager/employee-info.tpl.html",controller:"employeeInfo"}}}).state("root.policy-info",{url:"/policy-info",views:{"@":{templateUrl:"templates/data-manager/policy-info.tpl.html",controller:"policyInfo"}}})}e.$inject=["$stateProvider"],angular.module("data-manager",[]).config(e).controller("employeeInfo",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.activeStatusList=[{id:null,text:"请选择激活状态"},{id:1,text:"已激活"},{id:0,text:"未激活"}],e.paramsInit=function(){e.searchParams={activeStatus:null,businessId:e.businessList&&e.businessList[0].id||null,businessName:null,employeeTypeId:null,employeeTypeName:null,endActiveDate:null,startActiveDate:null,pageIndex:1,pageCount:20},e.employeeList=[{id:null,text:"请选择人群"}]},e.loadEmployee=function(n){e.employeeList=e.employeeList.slice(0,1),e.searchParams.employeeTypeId=null,e.searchParams.employeeTypeName=null,n&&o.run("businessEmployeeQuery",{businessId:n},function(n){if(n.model.length>0){e.employeeList=e.employeeList.concat(n.model);for(var o=1;o<e.employeeList.length;o++)e.employeeList[o].text=e.employeeList[o].name+" (人群ID: "+e.employeeList[o].id+")"}},function(e){})},e.transData=function(n,o){var t=[],a="";t="business"==o?e.businessList:e.employeeList;for(var s=0;s<t.length;s++)if(n==t[s].id){a=t[s].name;break}return a},e.loadData=function(n){e.searchParams.businessName=e.transData(e.searchParams.businessId,"business"),e.searchParams.employeeTypeName=e.transData(e.searchParams.employeeTypeId,"employee"),e.searchParams.endActiveDate&&"string"!=typeof e.searchParams.endActiveDate?e.searchParams.endActiveDate=t.date2string(e.searchParams.endActiveDate):"",e.searchParams.startActiveDate&&"string"!=typeof e.searchParams.startActiveDate?e.searchParams.startActiveDate=t.date2string(e.searchParams.startActiveDate):"",
n&&(e.searchParams.pageIndex=1),o.run("queryemployee",e.searchParams,function(n){e.pageInfo=n.pageInfo,e.employeeInfoList=n.rows,e.businessName=e.searchParams.businessName;var o=angular.copy(e.searchParams);delete o.pageIndex,delete o.pageCount,e.exportParams=o},function(e){})},e.loadBusiness=function(){var n={pageIndex:1,pageCount:1e3,keywords:null,sort:null,orderBy:null};o.run("businessQueryAll",n,function(n){e.businessList=n.rows,e.paramsInit(),e.businessList.length>0&&e.loadEmployee(e.businessList[0].id),e.loadData()},function(e){})},e.loadBusiness(),e.pageChanged=function(){e.searchParams.pageIndex=e.pageInfo.pageIndex,e.loadData()},e._export=function(){var n=o.getUrl("exportemployee",e.exportParams);window.location.href=n},e.startDayOpen=function(n){e.startDay.opened=!0},e.startDay={opened:!1},e.endDayOpen=function(n){e.endDay.opened=!0},e.endDay={opened:!1}}]).controller("policyInfo",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.paramsInit=function(){e.searchParams={endLeadtime:null,endUndwrtDate:null,startLeadtime:null,startUndwrtDate:null,pageIndex:1,pageCount:20}},e.loadData=function(n){e.searchParams.endLeadtime&&"string"!=typeof e.searchParams.endLeadtime?e.searchParams.endLeadtime=t.date2string(e.searchParams.endLeadtime):"",e.searchParams.endUndwrtDate&&"string"!=typeof e.searchParams.endUndwrtDate?e.searchParams.endUndwrtDate=t.date2string(e.searchParams.endUndwrtDate):"",e.searchParams.startLeadtime&&"string"!=typeof e.searchParams.startLeadtime?e.searchParams.startLeadtime=t.date2string(e.searchParams.startLeadtime):"",e.searchParams.startUndwrtDate&&"string"!=typeof e.searchParams.startUndwrtDate?e.searchParams.startUndwrtDate=t.date2string(e.searchParams.startUndwrtDate):"",n&&(e.searchParams.pageIndex=1),o.run("querypolicy",e.searchParams,function(n){e.pageInfo=n.pageInfo,e.policyInfoList=n.rows;var o=angular.copy(e.searchParams);delete o.pageIndex,delete o.pageCount,e.exportParams=o},function(e){})},e.paramsInit(),e.loadData(),e.pageChanged=function(){e.searchParams.pageIndex=e.pageInfo.pageIndex,e.loadData()},e._export=function(){var n=o.getUrl("exportpolicy",e.exportParams);window.location.href=n},e.transType=function(e){var n="";switch(e){case"1":n="身份证";break;case"2":n="护照";break;case"3":n="军官证/士兵证";break;case"6":n="港澳通行证/回乡证或台胞证";break;default:n="其他"}return n}}])}(),function(){"use strict";function e(e){e.state("root.data-table-demo",{url:"/data-table-demo",views:{"@":{templateUrl:"templates/data-table-demo/data-table-demo.tpl.html",controller:"DataTableDemo as docs"}}})}function n(e,n){var o=this;o.someMethos=function(){n.debug("I'm a method")},e.paramInitial=function(){e.param={page:1,name:null,identifyType:null,identifyNo:null}},e.paramInitial()}e.$inject=["$stateProvider"],n.$inject=["$scope","$log"],angular.module("data-table-demo",[]).config(e).controller("searchForm",["$scope",function(e){e.search=function(){e.$$nextSibling.loadData()},e.clean=function(){e.$parent.paramInitial()}}]).controller("DataTableDemo",n).controller("employeeList",["$scope","$http","DataService",function(e,n,o){e.loadData=function(){o.getAll(e.$parent.param,function(n){e.employees=n.dataList})},e.loadData()}]).controller("PaginationDemoCtrl",["$scope",function(e){e.pageChanged=function(){e.$parent.param.page=e.bigCurrentPage,e.$$prevSibling.loadData()},e.itemsPerPage=3,e.bigTotalItems=6,e.bigCurrentPage=1}])}(),function(){"use strict";function e(e){e.state("root.employee",{url:"/employee",views:{"@":{templateUrl:"templates/employee/employee.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("employee",[]).config(e).controller("employee",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.businessId=o.getInitialParam("employeeQuery").businessId,e.employeeList={},e.paramInitial=function(){var n=o.getInitialParam("employeeQuery");e.employeeQuery={pageIndex:1,pageCount:20,businessId:n.businessId,employeeTypeId:null,keywords:null,userId:null,cardNo:null,mobile:null,orderBy:null,sort:null,outUserId:null}},e.loadeBusinessEmployee=function(){o.run("businessEmployeeQuery",null,function(n){e.businessEmployeeList=n.model,e.businessEmployeeListTmp=new Array;for(var o=0;o<e.businessEmployeeList.length;o++)e.businessEmployeeListTmp.push(e.businessEmployeeList[o]);e.businessEmployeeListTmp.unshift({id:null,name:"选择所属人群"}),e.employeeQuery.employeeTypeId=e.businessEmployeeListTmp[0].id},function(e){})},e.loadEmployee=function(){o.run("employeeQuery",e.employeeQuery,function(n){e.employeeList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.paramInitial(),e.loadeBusinessEmployee(),e.loadEmployee(),e.transNull=function(e){return""==e?null:e},e.search=function(){e.employeeQuery.mobile=e.transNull(e.employeeQuery.mobile),e.employeeQuery.cardNo=e.transNull(e.employeeQuery.cardNo),e.employeeQuery.userId=e.transNull(e.employeeQuery.userId),e.loadEmployee()},e.clean=function(){e.orderBy=null,e.sortString=null,e.paramInitial(),e.loadEmployee()},e.openModal=function(n,o){if(e.opration=n,t.modalStus(!0),"show"==n){if(e.employeeShow=o,e.employeeShow.employeeTypeId)for(var a=0;a<e.businessEmployeeList.length;a++)if(e.businessEmployeeList[a].id==e.employeeShow.employeeTypeId){e.employeeShow.employeeTypeName=e.businessEmployeeList[a].name;break}}else"import"==n||(o?e.employeeEdit={id:o.id,name:o.name,staffId:o.staffId,identityType:o.identityType,identityId:o.identityId,businessId:e.businessId,employeeTypeId:o.employeeTypeId,enable:o.enable,status:o.status,insuranceId:o.insuranceId,mobile:o.mobile}:e.employeeEdit={name:null,staffId:null,identityType:1,identityId:null,businessId:e.businessId,employeeTypeId:e.businessEmployeeList[0].id,enable:!0,status:1,mobile:null});e.modalShow="open"},e.chooseFile=function(){var n=event.target.files[0];n&&(e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else{var o=n.target.result;e.fileBase64=o}},e.reader.readAsDataURL(n))},e.saveEmployeeEdit=function(){if("create"==e.opration)e.employeeEdit.businessId=e.businessId,o.run("employeeCreate",e.employeeEdit,function(n){e.loadEmployee(),e.closeModal()},function(e){});else if("import"==e.opration){var n=o.getInitialParam("employeeImport");n.file=e.fileBase64,o.run("employeeImport",null,function(n){e.loadEmployee(),e.closeModal()},function(e){})}else e.employeeEdit.businessId=e.businessId,o.run("employeeUpdate",e.employeeEdit,function(n){e.loadEmployee(),e.closeModal()},function(e){})},e.closeModal=function(){e.modalShow=null,t.modalStus(!1)},e.sortByString=function(){e.orderBy=null;var n=event.target.getAttribute("class");e.sortString=event.target.getAttribute("aria-label"),"sorting"==n||"sorting_asc"==n?e.orderBy="DESC":e.orderBy="ASC",e.employeeQuery.orderBy=e.sortString,e.employeeQuery.sort=e.orderBy,e.employeeQuery.pageIndex=1,e.loadEmployee()},e.pageChanged=function(){e.employeeQuery.pageIndex=e.pageInfo.pageIndex,e.loadEmployee()}}])}(),function(){"use strict";function e(e){e.state("root.employee-service",{url:"/employee-service",views:{"@":{templateUrl:"templates/employee-service/employee-service.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("employee-service",[]).config(e).controller("employeeService",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.loadCommonService=function(){o.run("serviceQueryAll",null,function(n){e.serviceList=n.rows,e.loadBusinessService()},function(e){})},e.loadBusinessService=function(){o.run("businessServiceQuery",null,function(n){e.businessServicePool=n.model;var o,t;for(o=0;o<e.businessServicePool.length;o++)for(t=0;t<e.serviceList.length;t++)if(e.businessServicePool[o].serviceId==e.serviceList[t].id){e.businessServicePool[o].name=e.serviceList[t].name;break}e.loadEmployeeService()},function(e){})},e.loadEmployeeService=function(){o.run("employeeTypeServiceQueryAll",null,function(n){e.employeeTypeServicePool=n.model;var o,t;for(o=0;o<e.employeeTypeServicePool.length;o++)for(t=0;t<e.businessServicePool.length;t++)if(e.employeeTypeServicePool[o].businessServicePoolId==e.businessServicePool[t].id){e.employeeTypeServicePool[o].name=e.businessServicePool[t].name;break}for(e.serviceAvailableList=[],o=0;o<e.businessServicePool.length;o++)e.serviceAvailableList.push({businessServicePoolId:e.businessServicePool[o].id,name:e.businessServicePool[o].name,enable:e.businessServicePool[o].enable});for(o=0;o<e.employeeTypeServicePool.length;o++)for(t=0;t<e.serviceAvailableList.length;t++)e.employeeTypeServicePool[o].businessServicePoolId==e.serviceAvailableList[t].businessServicePoolId&&e.serviceAvailableList.splice(t,1);for(o=0;o<e.serviceAvailableList.length;o++)0==e.serviceAvailableList[o].enable&&(e.serviceAvailableList[o].name+="（该服务未启用）")},function(e){})},e.loadCommonService(),e.openModal=function(n,o){e.opration=n,t.modalStus(!0),"show"==n?(e.employeeTypeServiceShow=o,e.modalShow="show"):o?(e.employeeTypeServiceName=o.name,e.employeeTypeServiceEdit={enable:o.enable,businessServicePoolId:o.businessServicePoolId,id:o.id},e.modalShow="show"):0==e.serviceAvailableList.length?alert("当前企业没有服务，请先在企业服务管理中创建企业服务后再创建人群服务。"):(e.employeeTypeServiceEdit={businessServicePoolId:e.serviceAvailableList[0].businessServicePoolId,enable:!0},e.modalShow="show")},e.saveServiceEdit=function(){if("create"==e.opration){var n=o.getInitialParam("employeeTypeServiceCreate");n.enable=e.employeeTypeServiceEdit.enable,n.businessServicePoolId=e.employeeTypeServiceEdit.businessServicePoolId,o.run("employeeTypeServiceCreate",null,function(n){e.loadEmployeeService(),e.closeModal()},function(e){})}else"edit"==e.opration&&(e.employeeTypeServiceEdit.employeeTypeId=o.getInitialParam("employeeTypeServiceUpdate").employeeTypeId,o.run("employeeTypeServiceUpdate",e.employeeTypeServiceEdit,function(n){e.loadEmployeeService(),e.closeModal()},function(e){}))},e.closeModal=function(){e.modalShow=null,e.opration=null,t.modalStus(!1)}}])}(),function(){"use strict";function e(e){e.state("root.logger",{url:"/logger",views:{"@":{templateUrl:"templates/logger/logger.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("logger",[]).config(e).controller("logger",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(e){console.log(e);var n=e.getFullYear(),o=e.getMonth()+1,t=e.getDate();e.getHours(),e.getMinutes(),e.getSeconds();return o=o<10?"0"+o:o,t=t<10?"0"+t:t,n+"-"+o+"-"+t}function s(){e.createStartTime&&(e.loggerAction.createStartTime=a(e.createStartTime)),e.createEndTime&&(e.loggerAction.createEndTime=a(e.createEndTime)),o.run("loggerQuery",e.loggerAction,function(n){e.loggerList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})}e.paramInitial=function(){e.loggerAction={pageIndex:1,pageCount:20,staffName:null,moduleName:null,operationType:null,operationDescription:null,createStartTime:null,createEndTime:null,orderBy:null,sort:null}},e.operationTypeList=[{value:null,text:"请选择操作类型"},{value:2,text:"添加"},{value:3,text:"修改"},{value:4,text:"删除"}],e.pageChanged=function(){e.loggerAction.pageIndex=e.pageInfo.pageIndex,s()},e.init=function(){e.paramInitial(),e.createStartTime=null,e.createEndTime=null,s()},e.showModal=!1,e.collapseId=null,e.init(),e.search=function(){s()},e.sortByString=function(){e.orderBy=null;var n=event.target.getAttribute("class");e.sortString=event.target.getAttribute("aria-label"),"sorting"==n||"sorting_asc"==n?e.orderBy="DESC":e.orderBy="ASC",e.loggerAction.orderBy=e.sortString,e.loggerAction.sort=e.orderBy,e.loggerAction.pageIndex=1,s()},e.showDetail=function(n){var a=o.getInitialParam("loggerDetailQuery");a.actionId=n.id,e.comment=n.comment,o.run("loggerDetailQuery",null,function(n){e.detailList=n.model,e.showModal=!0,t.modalStus(!0)},function(e){})},e.hideModal=function(){e.showModal=!1,e.comment=null,e.detailList=null,e.contentList=null,t.modalStus(!1)},e.showDetailContent=function(n){var t=o.getInitialParam("detailContentQuery");t.loggerId=n,o.run("detailContentQuery",null,function(n){e.contentList=n.model},function(e){});var a=event.target.getAttribute("data-action");"expand"==a?(e.collapseId=n,e.detailContentId=n):(e.collapseId=null,e.detailContentId=null)},e.startDayOpen=function(n){e.startDay.opened=!0},e.startDay={opened:!1},e.endDayOpen=function(n){e.endDay.opened=!0},e.endDay={opened:!1}}])}(),function(){"use strict";function e(e){e.state("root.role-authorization",{url:"/role-authorization/:id",views:{"@":{templateUrl:"templates/role/role-authorization.tpl.html",controller:"roleAuthCtrl"}}})}e.$inject=["$stateProvider"],angular.module("role-authorization",[]).config(e).controller("roleAuthCtrl",["$scope","$state","DataService","$rootScope","_",function(e,n,o,t,a){function s(){o.run("roleAuthQuery",{roleId:e.roleId},function(n){0==n.success?(e.roleAuthList=null,e.roleOrigin=null,e.roleEditList=null):(e.roleAuthList=n.model,e.roleOrigin=angular.copy(e.roleAuthList),e.roleEditList=angular.copy(e.roleAuthList))},function(e){})}e.roleId=n.params.id,e.editflag=!0,s(),e.saveEdit=function(){a.isEqual(e.roleOrigin,e.roleEditList)?t.showToast("error","您并未做任何修改！"):o.run("roleAuthUpdate",{roleAuthorizations:e.roleEditList},function(n){0==n.success?6002==n.errorCode&&(e.roleAuthList=angular.copy(e.roleOrigin),e.roleEditList=angular.copy(e.roleOrigin)):(s(),t.showToast("success","修改成功！"))},function(e){})},e.changeVal=function(n,o){e.roleEditList[n][o]=event.target.checked}}])}(),function(){"use strict";function e(e){e.state("root.role-module",{url:"/role-module",views:{"@":{templateUrl:"templates/role/role-module.tpl.html",controller:"roleMCtrl"}}})}e.$inject=["$stateProvider"],angular.module("role-module",[]).config(e).controller("roleMCtrl",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(){o.run("moduleQueryAll",null,function(n){e.moduleList=n.model},function(e){})}a(),e.saveEdit=function(e){var n=angular.copy(e);n.enable=!n.enable,o.run("moduleUpdate",n,function(e){a(),t.showToast("success","修改成功！")},function(e){})}}])}(),function(){"use strict";function e(e){e.state("root.role-user",{url:"/role-user/:id",views:{"@":{templateUrl:"templates/role/role-user.tpl.html",controller:"roleUserCtrl"}}})}e.$inject=["$stateProvider"],angular.module("role-user",[]).config(e).controller("roleUserCtrl",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(){o.run("getRoleUserByRoleId",{roleId:e.roleId},function(n){e.roleUserList=n.model},function(e){})}e.roleId=n.params.id,e.user={roleId:e.roleId,staffName:null},a(),e.openModal=function(){e.modalShow="new",t.modalStus(!0)},e.closeModal=function(){e.modalShow=null,e.user.staffName=null,t.modalStus(!1)},e.deleteUser=function(e){t.showToast("confirm","确定删除吗？",function(){o.run("roleUserDelete",{id:e},function(e){a()},function(e){})},null)},e.saveUser=function(){o.run("roleUserCreate",e.user,function(n){e.closeModal(),a()},function(e){})}}])}(),function(){"use strict";function e(e){e.state("root.role",{url:"/role",views:{"@":{templateUrl:"templates/role/role.tpl.html",controller:"roleCtrl"}}})}e.$inject=["$stateProvider"],angular.module("role",[]).config(e).controller("roleCtrl",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(){o.run("roleQueryAll",null,function(n){e.roleList=n.model},function(e){})}e.modalShow=null,e.roleEdit={name:null},a(),e.openModal=function(n){n?(e.modalShow="modify",e.roleEdit.name=n.name,e.roleEdit.id=n.id):e.modalShow="new",t.modalStus(!0)},e.deleteRole=function(e){t.showToast("confirm","确定删除吗？",function(){o.run("roleDelete",{id:e},function(e){a()},function(e){})},null)},e.closeModal=function(){e.modalShow=null,e.roleEdit.name=null,e.roleEdit.id&&delete e.roleEdit.id,t.modalStus(!1)},e.saveRoleEdit=function(){var n="",t=angular.copy(e.roleEdit);e.modalShow&&"new"==e.modalShow?n="roleCreate":e.modalShow&&"modify"==e.modalShow&&(n="roleUpdate"),o.run(n,t,function(n){e.closeModal(),a()},function(e){})}}])}(),function(){"use strict";function e(e){e.state("root.statistic",{url:"/statistic",views:{"@":{templateUrl:"templates/statistic/statistic.tpl.html",controller:"statistic"}}})}e.$inject=["$stateProvider"],angular.module("statistic",[]).config(e).controller("statistic",["$scope","$state","DataService","$rootScope",function(e,n,o,t){e.dataRangeList=[{id:"0",name:"日"},{id:"1",name:"周"},{id:"2",name:"月"},{id:"3",name:"季度"},{id:"4",name:"年"}],e.detailC=[{value:!0,text:"明细"},{value:!1,text:"总计"}],e.paramsInit=function(){e.searchParams={businessId:null,employeeTypeId:null,dateRangeType:"0",statisticType:"0",detail:!1,pageIndex:1,pageCount:20},e.employeeList=[{id:null,text:"请选择人群"}]},e.loadEmployee=function(n){e.employeeList=e.employeeList.slice(0,1),e.searchParams.employeeTypeId=null,n&&o.run("businessEmployeeQuery",{businessId:n},function(n){if(n.model.length>0){e.employeeList=e.employeeList.concat(n.model);for(var o=1;o<e.employeeList.length;o++)e.employeeList[o].text=e.employeeList[o].name+" (人群ID: "+e.employeeList[o].id+")"}},function(e){})},e.loadBusiness=function(){var n={pageIndex:1,pageCount:1e3,keywords:null,sort:null,orderBy:null};o.run("businessQueryAll",n,function(n){e.businessList=n.rows,e.businessList.unshift({id:null,name:"请选择企业"})},function(e){})},e.loadData=function(){o.run("statisticsQuery",e.searchParams,function(n){e.show={tdFlag:e.searchParams.detail,titleType:e.searchParams.statisticType},e.pageInfo=n.pageInfo,e.statisticList=n.rows},function(e){})},e.init=function(){e.loadBusiness(),e.paramsInit(),e.loadData()},e.init(),e.pageChanged=function(){e.searchParams.pageIndex=e.pageInfo.pageIndex,e.loadData()},e.transData=function(n,o){var t=[],a="";t="business"==o?e.businessList:e.dataRangeList;for(var s=0;s<t.length;s++)if(n==t[s].id){a=t[s].name;break}return a}}])}(),function(){"use strict";function e(e){e.state("root.showcase-info",{url:"/showcase-info",views:{"@":{templateUrl:"templates/showcase-info/showcase-info.tpl.html"}}})}e.$inject=["$stateProvider"],angular.module("showcase-info",[]).config(e).controller("showcaseInfo",["$scope","$state","DataService","$rootScope",function(e,n,o,t){function a(n,o){n&&(n.size>2097152?(t.showToast("error","允许上传的图片的最大为2M，请重新选择"),t.$apply()):(e.reader=new FileReader,e.reader.onloadend=function(n){if(e.reader.error)console.log("error");else{var a=n.target.result,i=new Image;i.src=a,i.onload=function(){var l=i.width,r=i.height,u=s(l,r);1==u?(e.showcaseImgShow=a,e.showcaseInfoEdit.orgImgUrl=n.target.result,e.$apply()):(o.value="",t.showToast("error",u),t.$apply())}}},e.reader.readAsDataURL(n)))}function s(n,o){var a=!0,s=e.showcaseInfoEdit.position;return 0==s?a=!(n>320||o>150)||"长不能超过320px, 高不能超过150px":1==s?a=!(n>t.constant.showcasePlugL.width||o>t.constant.showcasePlugL.height)||"长不能超过"+t.constant.showcasePlugL.width+"px, 高不能超过"+t.constant.showcasePlugL.height+"px":2==s&&(a=!(n>t.constant.showcasePlugR.width||o>t.constant.showcasePlugR.height)||"长不能超过"+t.constant.showcasePlugR.width+"px, 高不能超过"+t.constant.showcasePlugR.height+"px"),a}e.tfsUrl=o.getTfsUrl(),e.scenceList=[{value:null,text:"请选择使用位置"}],e.timingOffDateOpen=function(n){e.timingOffDate.opened=!0},e.timingOffDate={opened:!1},e.timingOnDateOpen=function(n){e.timingOnDate.opened=!0},e.timingOnDate={opened:!1},e.showcase={scene:null,position:null,pageIndex:1,pageCount:20},e.changeScene=function(n,o,a){var s=[];s=0==n?[{value:null,text:"请选择使用位置"},{value:3,text:"企业版首页广告位"}]:1==n?[{value:null,text:"请选择使用位置"},{value:1,text:"插件版热卖商品左侧"+("search"==o?"":" ("+t.constant.showcasePlugL.width+"px * "+t.constant.showcasePlugL.height+"px)")},{value:2,text:"插件版热卖商品右侧"+("search"==o?"":" ("+t.constant.showcasePlugR.width+"px * "+t.constant.showcasePlugR.height+"px)")}]:[{value:null,text:"请选择使用位置"}],"search"==o?(e.showcase.position=null,e.scenceList=angular.copy(s)):"modal"==o&&(e.senceEditList=angular.copy(s),a&&(e.showcaseInfoEdit.position=null))},e.loadShowcaseInfo=function(n){n&&"clean"==n&&(e.showcase={scene:null,position:null,pageIndex:1,pageCount:20}),"null"==e.showcase.scene?e.showcase.scene=null:"","null"==e.showcase.position?e.showcase.position=null:"",o.run("showcaseQueryAll",e.showcase,function(n){e.showcaseInfoList=n.rows,e.pageInfo=n.pageInfo,e.totalPage=Math.ceil(n.pageInfo.totalCount/n.pageInfo.pageCount)},function(e){})},e.loadList=function(){var n={pageIndex:1,pageCount:1e3,keywords:null,sort:null,orderBy:null},t={pageIndex:1,pageCount:1e3};o.run("businessQueryAll",n,function(n){e.businessList=n.rows,e.businessList.unshift({id:null,name:"请选择企业"})},function(e){}),o.run("channelQueryAll",t,function(n){e.channelInfoList=n.rows,e.channelInfoList.unshift({id:null,name:"请选择渠道"})},function(e){})},e.pageChanged=function(){e.showcase.pageIndex=e.pageInfo.pageIndex,e.loadShowcaseInfo()},e.resetLinkId=function(){e.showcaseInfoEdit.linkId=null},e.loadList(),e.loadShowcaseInfo(),e.openModal=function(n,o){e.opration=n,t.modalStus(!0),"show"==n?(e.showcaseInfoShow=o,null!=e.showcaseInfoShow.imgUrl&&(e.showcaseImgShow=e.tfsUrl+e.showcaseInfoShow.imgUrl)):o?(e.showcaseInfoEdit=angular.copy(o),e.changeScene(e.showcaseInfoEdit.scene,"modal"),e.showcaseInfoEdit.orgImgUrl=null,e.showcaseInfoEdit.imgUrl&&(e.showcaseImgShow=e.tfsUrl+e.showcaseInfoEdit.imgUrl)):(e.showcaseInfoEdit={title:null,summary:null,status:10,scene:0,linkId:null,position:null,operationContent:null,orgImgUrl:null,serialNo:null,timingOnDate:null,timingOffDate:null},e.changeScene(e.showcaseInfoEdit.scene,"modal")),e.modalShow="show"},e.changeShowcase=function(){var n="",t=1;"create"==e.opration?n="showcaseCreate":"edit"==e.opration&&(n="showcaseUpdate",t=e.showcase.pageIndex),o.run(n,e.showcaseInfoEdit,function(n){e.showcase.pageIndex=t,e.loadShowcaseInfo(),e.closeModal()},function(e){})},e.saveShowcaseEdit=function(){if(e.showcaseImgShow&&""!=e.showcaseImgShow){var n=new Image;n.src=e.showcaseImgShow;n.onload=function(){var o=n.width,a=n.height,i=s(o,a);1!=i?(t.showToast("error",i),t.$apply()):e.changeShowcase()}}else e.changeShowcase()},e.closeModal=function(){e.modalShow=null,e.opration=null,e.showcaseImgShow="",e.showcaseInfoEdit={},e.showcaseInfoShow={},t.modalStus(!1)},e.transLinkId=function(n,o){var t="";if("0"==o)var a=e.businessList;else if("1"==o)var a=e.channelInfoList;for(var s=0;s<a.length;s++)if(n==a[s].id){t=a[s].name;break}return t},e.chooseImg=function(){var e=event.target.files[0];a(e,event.target)}}])}();